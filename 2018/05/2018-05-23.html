<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>May 23, 2018</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/styles/global.css"><link rel="stylesheet" href="/diary/styles/tomorrow.css"><link rel="stylesheet" href="/diary/styles/diary.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63818301-1', 'auto');
ga('send', 'pageview');</script></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>May 23, 2018</h1></header><div class="content"><div class="diary"><h2 id="c-">C语言工程化之库的链接</h2>
<blockquote>
<p>关于链接，CSAPP的第七章有详尽的介绍。</p>
</blockquote>
<blockquote>
<p>本文中的资料大部分来源于 <a href="https://www.cs.swarthmore.edu/~newhall/unixhelp/howto_C_libraries.html">https://www.cs.swarthmore.edu/~newhall/unixhelp/howto_C_libraries.html</a> </p>
</blockquote>
<h3 id="-o-a-so-">.o .a .so文件究竟是什么？</h3>
<ul>
<li>.o是object文件，这种文件包含了编译之后的代码和数据，以及一些元信息。object file分为relocatable、excutable、shared object三类。</li>
<li>.a是archive，是多个object文件的集合。</li>
<li>.so是shared object。</li>
</ul>
<h3 id="static-linking">Static Linking</h3>
<p>关于static linking是什么？解决了什么问题？这部分可以看CSAPP的7.6.2这一节</p>
<h3 id="-">自己写一个简单的库</h3>
<p>所谓的静态链接的库，其实就是多个.o文件可以打包为一个.a文件。linker对于这类文件，会用一种算法去定位里面那些模块被引用了，然后按需引入，编译成最终的可执行文件。</p>
<ul>
<li>参见上面链接里的 CREATING AND USING YOUR OWN LIBRARY CODE 一节</li>
</ul>
<p>Notice：编译库的时候，编译出多个object，在linux下面可以用<code>ar</code>工具打包成一个archive</p>
<h3 id="-">如何链接一个库</h3>
<p>gcc 这边有三种语法：</p>
<pre><code><span class="hljs-tag">gcc</span>  <span class="hljs-tag">test</span><span class="hljs-class">.c</span> <span class="hljs-tag">mylib</span><span class="hljs-class">.o</span>
</code></pre><p>直接在编译参数里加上一个object的文件名</p>
<p>或者，如果库是static linking的archive，并且位置在<code>/usr/lib</code>下面：</p>
<pre><code>gcc  test<span class="hljs-class">.c</span> -lmylib
</code></pre><p>如果库的位置不在默认位置，可以用-L参数指定</p>
<pre><code>gcc  test.c -<span class="hljs-constant">L</span>/home/newhall/<span class="hljs-class"><span class="hljs-keyword">lib</span> -<span class="hljs-title">lmylib</span></span>
</code></pre><h3 id="-">动态链接需要注意的事项</h3>
<p>// TODO</p>
<h3 id="-libuv">链接实战：Libuv</h3>
<p><a href="https://stackoverflow.com/questions/34896114/how-to-install-c-library-libuv-on-os-x?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa">参考这个Stack Overflow问题</a></p>
</div></div><footer class="footer"><address class="author">Copyright &copy;<a rel="author" href="https://github.com/zxc0328" class="author-name">ccnuzindex</a>-<a href="https://github.com/zxc0328/diary-content.git" class="source-repo">Source</a></address><p>Generated by<a href="https://github.com/joyeecheung/diary" class="site-repo">Joyee Cheung&#39;s diary generator</a></p></footer></body></html>