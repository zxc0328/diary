<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>March 27, 2016</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/styles/global.css"><link rel="stylesheet" href="/diary/styles/tomorrow.css"><link rel="stylesheet" href="/diary/styles/diary.css"></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>March 27, 2016</h1></header><div class="content"><div class="diary"><h2 id="call-apply-s-performance-issue">Call &amp; Apply&#39;s Performance Issue</h2>
<p>I was looking for some real world example of Pub/Sub pattern in Backbone&#39;s event system when I came across something like this:</p>
<pre><code><span class="hljs-keyword">var</span> triggerEvents = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(events, args)</span> </span>{
    <span class="hljs-keyword">var</span> ev, i = -<span class="hljs-number">1</span>, l = events.length, a1 = args[<span class="hljs-number">0</span>], a2 = args[<span class="hljs-number">1</span>], a3 = args[<span class="hljs-number">2</span>];
    <span class="hljs-keyword">switch</span> (args.length) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">while</span> (++i &lt; l) (ev = events[i]).<span class="hljs-keyword">callback</span>.call(ev.ctx); <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">while</span> (++i &lt; l) (ev = events[i]).<span class="hljs-keyword">callback</span>.call(ev.ctx, a1); <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">while</span> (++i &lt; l) (ev = events[i]).<span class="hljs-keyword">callback</span>.call(ev.ctx, a1, a2); <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">while</span> (++i &lt; l) (ev = events[i]).<span class="hljs-keyword">callback</span>.call(ev.ctx, a1, a2, a3); <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">default</span>: <span class="hljs-keyword">while</span> (++i &lt; l) (ev = events[i]).<span class="hljs-keyword">callback</span>.apply(ev.ctx, args); <span class="hljs-keyword">return</span>;
    }
  };
</code></pre><p>And the annotation beside this is </p>
<blockquote>
<p>A difficult-to-believe, but optimized internal dispatch function for triggering events. Tries to keep the usual cases speedy (most internal Backbone events have 3 arguments).</p>
</blockquote>
<h3 id="call-apply-s-performance-benchmark">Call &amp; Apply&#39;s Performance:Benchmark</h3>
<p>I found <a href="https://jsperf.com/test-call-vs-apply/12">some benchmark</a> on JSPerf. And it returns out there is only some subtle difference in results. </p>
<p>The benchmark only test the case when there is only one paramater. So the difference maybe more distinct when there is more paramaters.</p>
<h3 id="call-apply-s-performance-insight-through-ecma-spec">Call &amp; Apply&#39;s Performance:Insight through ECMA spec</h3>
<p>The definition on ECMA 5.1 about call and apply only has some subtle difference. Apply takes array-like object as second paramater so it has an extra step of looping the object and pushing them into the arguments list inside the function.</p>
<p>So it&#39;s pretty fair to say that call will be even faster when there is more paramaters. We&#39;ll do some test to prove that in the near future.</p>
<h3 id="links">Links</h3>
<ul>
<li><a href="http://backbonejs.org/docs/backbone.html#section-48">Backbone Event&#39;s source</a></li>
<li><a href="http://www.ecma-international.org/ecma-262/5.1/#sec-15.3.4.3">Call &amp; Apply&#39;s ECMA spec</a></li>
</ul>
<h3 id="todo">Todo</h3>
<ul>
<li>Make a test when there are 10 paramaters or more</li>
</ul>
</div></div><footer class="footer"><address class="author">Copyright &copy;<a rel="author" href="https://github.com/zindex" class="author-name">Zindex</a>-<a href="https://github.com/zxc0328/diary-content" class="source-repo">Source</a></address><p>Generated by<a href="https://github.com/joyeecheung/diary" class="site-repo">Joyee Cheung&#39;s diary generator</a></p></footer></body></html>