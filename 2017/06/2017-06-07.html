<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>June 7, 2017</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/styles/global.css"><link rel="stylesheet" href="/diary/styles/tomorrow.css"><link rel="stylesheet" href="/diary/styles/diary.css"></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>June 7, 2017</h1></header><div class="content"><div class="diary"><h2 id="es6-proxy-vue-">ES6 Proxy，以及在Vue中的使用</h2>
<p>简单地说，Proxy就是在一个JS对象的基础上增加的一层封装。一个对象的Proxy，有几个方法可以使用，<code>set</code>，<code>get</code>，<code>has</code>等等。这些对象的特点就是可以拦截对对象属性的操作，<code>set</code>和<code>get</code>就不用说了，<code>has</code>是对<code>in</code>操作符的拦截，此外还可以用<code>deleteProperty</code>拦截<code>delete</code>操作符，用<code>defineProperty</code>拦截<code>Object.defineProperty</code>操作等等。除了<code>set</code>和<code>get</code>外的Proxy方法清单：</p>
<ul>
<li>has – traps in operator</li>
<li>deleteProperty – traps delete operator</li>
<li>defineProperty – traps Object.defineProperty and declarative + alternatives</li>
<li>enumerate – traps for..in loops</li>
<li>ownKeys – traps Object.keys and related methods</li>
<li>apply – traps function calls</li>
</ul>
<h3 id="vue-proxy-">Vue中Proxy的使用</h3>
<p><em>src/core/instance/proxy.js</em></p>
<pre><code><span class="hljs-keyword">const</span> hasHandler = {
    has (target, <span class="hljs-variable">key</span>) {
      <span class="hljs-keyword">const</span> has = <span class="hljs-variable">key</span> in target
      <span class="hljs-keyword">const</span> isAllowed = allowedGlobals(<span class="hljs-variable">key</span>) || <span class="hljs-variable">key</span>.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">'_'</span>
      <span class="hljs-keyword">if</span> (!has &amp;&amp; !isAllowed) {
        warnNonPresent(target, <span class="hljs-variable">key</span>)
      }
      <span class="hljs-keyword">return</span> has || !isAllowed
    }
  }

  <span class="hljs-keyword">const</span> getHandler = {
    <span class="hljs-built_in">get</span> (target, <span class="hljs-variable">key</span>) {
      <span class="hljs-keyword">if</span> (typeof <span class="hljs-variable">key</span> === <span class="hljs-string">'string'</span> &amp;&amp; !(<span class="hljs-variable">key</span> in target)) {
        warnNonPresent(target, <span class="hljs-variable">key</span>)
      }
      <span class="hljs-keyword">return</span> target[<span class="hljs-variable">key</span>]
    }
  }
</code></pre><p>Vue中的Proxy主要是一个访问控制的作用。比如对于<code>_</code>开头的内部属性和方法，我们不希望用户在实例中可以访问到。又比如：</p>
<p><em>src/core/instance/proxy.js</em></p>
<pre><code><span class="hljs-keyword">if</span> (hasProxy) {
    <span class="hljs-keyword">const</span> isBuiltInModifier = makeMap(<span class="hljs-string">'stop,prevent,self,ctrl,shift,alt,meta'</span>)
    config.keyCodes = <span class="hljs-keyword">new</span> Proxy(config.keyCodes, {
      <span class="hljs-keyword">set</span> (target, key, <span class="hljs-keyword">value</span>) {
        <span class="hljs-keyword">if</span> (isBuiltInModifier(key)) {
          warn(`Avoid overwriting built-<span class="hljs-keyword">in</span> modifier <span class="hljs-keyword">in</span> config.keyCodes: .${key}`)
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
        } <span class="hljs-keyword">else</span> {
          target[key] = <span class="hljs-keyword">value</span>
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>
        }
      }
    })
  }
</code></pre><p>可以保证内置的keyCode设置不会被覆写。</p>
<h3 id="links">Links</h3>
<p>Ponyfoo的两篇文章</p>
<ul>
<li><a href="https://ponyfoo.com/articles/es6-proxies-in-depth">ES6 Proxies in Depth</a></li>
<li><a href="https://ponyfoo.com/articles/es6-proxy-traps-in-depth">ES6 Proxy Traps in Depth</a></li>
</ul>
</div></div><footer class="footer"><address class="author">Copyright &copy;<a rel="author" href="https://github.com/zindex" class="author-name">Zindex</a>-<a href="https://github.com/zxc0328/diary-content" class="source-repo">Source</a></address><p>Generated by<a href="https://github.com/joyeecheung/diary" class="site-repo">Joyee Cheung&#39;s diary generator</a></p></footer></body></html>