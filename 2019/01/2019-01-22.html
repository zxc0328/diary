<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>January 22, 2019</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/styles/global.css"><link rel="stylesheet" href="/diary/styles/tomorrow.css"><link rel="stylesheet" href="/diary/styles/diary.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63818301-1', 'auto');
ga('send', 'pageview');</script></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>January 22, 2019</h1></header><div class="content"><div class="diary"><h2 id="go-module-">Go module 学习</h2>
<h3 id="go-module">Go module</h3>
<p>今天算是终于认真看了一下 Go 新的 Module 机制。首先这个特性是最近的 1.11 版本引入的。之前社区有过很多的解决方案，比如 <a href="https://golang.github.io/dep/">Dep</a>。但 Go 的开发团队最终决定引入官方的包管理机制。</p>
<p>Go Module 首先引入了模块的概念，模块的配置文件是一个位于模块根目录的 <code>.mod</code> 文件，里面描述了模块的依赖和模块名称等等元信息。</p>
<p>例如：</p>
<pre><code><span class="hljs-function">module mod

<span class="hljs-title">require</span> <span class="hljs-params">(
    github.com/gin-contrib/sse v0<span class="hljs-number">.0</span><span class="hljs-number">.0</span>-<span class="hljs-number">20170109093832</span>-<span class="hljs-number">22</span>d885f9ecc7 <span class="hljs-comment">// indirect</span>
    github.com/gin-gonic/gin v1<span class="hljs-number">.3</span><span class="hljs-number">.0</span>
    github.com/golang/protobuf v1<span class="hljs-number">.2</span><span class="hljs-number">.0</span> <span class="hljs-comment">// indirect</span>
    github.com/json-iterator/go v1<span class="hljs-number">.1</span><span class="hljs-number">.5</span> <span class="hljs-comment">// indirect</span>
    github.com/mattn/go-isatty v0<span class="hljs-number">.0</span><span class="hljs-number">.4</span> <span class="hljs-comment">// indirect</span>
    github.com/modern-go/concurrent v0<span class="hljs-number">.0</span><span class="hljs-number">.0</span>-<span class="hljs-number">20180306012644</span>-bacd9c7ef1dd <span class="hljs-comment">// indirect</span>
    github.com/modern-go/reflect2 v1<span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-comment">// indirect</span>
    github.com/ugorji/go/codec v0<span class="hljs-number">.0</span><span class="hljs-number">.0</span>-<span class="hljs-number">20181209151446</span>-<span class="hljs-number">772</span>ced7fd4c2 <span class="hljs-comment">// indirect</span>
    gopkg.in/go-playground/validator.v8 v8<span class="hljs-number">.18</span><span class="hljs-number">.2</span> <span class="hljs-comment">// indirect</span>
    gopkg.in/yaml.v2 v2<span class="hljs-number">.2</span><span class="hljs-number">.2</span> <span class="hljs-comment">// indirect</span>
)</span>
</span>
</code></pre><p>我们可以在现有项目中用 <code>go mod init moduleName</code> 一键初始化模块，项目里 import 的模块会被自动下载并记录到模块配置文件中。</p>
<h3 id="vendor">Vendor</h3>
<p>之前 Go 支持的 vendor 文件夹模式，go module 也支持。可以用 go mod vendor 命令来自动生成 vendor 文件夹。不过在 go build 的时候如果要用 vendor 文件夹中的文件，需要显示加上 -mod vendor 参数。</p>
<h3 id="versioning">Versioning</h3>
<p>Go module 解决的另一个大问题就是，之前 go get 是默认拉 Git 仓库 master 的代码，完全没有版本的概念。在 Go module 里面，mod 文件里记录了 tag，第一次 build 之后，这个 tag 号就不会自动升级到新的 major version 了（major version 的概念参考 semantic versioning）。如果需要升级，可以在业务代码里 import 的时候修改 import 的路径，在最后加上 tag 号。</p>
<h3 id="links">Links</h3>
<p>关于 Go Module 的一些介绍文章（更多文章可以直接 Google 搜 go module）：</p>
<ul>
<li><a href="https://roberto.selbach.ca/intro-to-go-modules/">Introduction to Go Modules</a></li>
<li><a href="https://dave.cheney.net/2018/07/14/taking-go-modules-for-a-spin">Taking Go modules for a spin</a></li>
<li><a href="https://ukiahsmith.com/blog/a-gentle-introduction-to-golang-modules/">A gentle introduction to Golang Modules</a></li>
</ul>
<p>Go 包管理的历史背景</p>
<p><a href="https://zhuanlan.zhihu.com/p/41627929">关于Go Module的争吵</a></p>
</div></div><footer class="footer"><address class="author">Copyright &copy;<a rel="author" href="https://github.com/zxc0328" class="author-name">ccnuzindex</a>-<a href="https://github.com/zxc0328/diary-content.git" class="source-repo">Source</a></address><p>Generated by<a href="https://github.com/joyeecheung/diary" class="site-repo">Joyee Cheung&#39;s diary generator</a></p></footer></body></html>