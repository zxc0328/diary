<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>October 6, 2019</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/styles/global.css"><link rel="stylesheet" href="/diary/styles/tomorrow.css"><link rel="stylesheet" href="/diary/styles/diary.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63818301-1', 'auto');
ga('send', 'pageview');</script></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>October 6, 2019</h1></header><div class="content"><div class="diary"><h3 id="ts-">TS 学习总结：编译器</h3>
<h4 id="ts-">TS 的编译流水线</h4>
<p>主要有以下几个部分：</p>
<ul>
<li>Scanner 词法解析器</li>
<li>Parser 语法解析器</li>
<li>Binder 语义分析</li>
<li>Checker 类型检查</li>
<li>Emitter 代码生成</li>
</ul>
<pre><code>SourceCode ~~ scanner ~~&gt; <span class="hljs-keyword">Token</span> Stream <span class="hljs-comment">// 首先源代码经过 scanner 解析生成 token 流</span>

<span class="hljs-keyword">Token</span> Stream ~~ parser ~~&gt; AST <span class="hljs-comment">// token 流经过 parser 构建为 AST</span>

AST ~~ binder ~~&gt; Symbols <span class="hljs-comment">// AST 经过 binder，生成符号表</span>

AST + Symbols ~~ checker ~~&gt; <span class="hljs-keyword">Type</span> Validation <span class="hljs-comment">// AST 和符号表经过 checker 进行类型检查</span>

AST + Checker ~~ emitter ~~&gt; JS <span class="hljs-comment">// 最后 AST 结合类型检查结果，生成最终的 JS 代码</span>
</code></pre><p>TS 比起普通的 JS 转译器（transpiler），比如 Babel，要多一个语义分析，类型检查的过程。所以 Binder 和 Checker 是 TS 编译过程里面最重要的过程。</p>
<p>TS 的 AST 的具体结构可以通过 <a href="https://ts-ast-viewer.com/">TypeScript AST Viewer</a> 来查看。</p>
<p>对具体编译过程代码可以看 TS 源码中 <code>src/compiler</code> 下的文件。TS Deep Dive 中的<a href="https://basarat.gitbooks.io/typescript/docs/compiler/overview.html">章节</a>也可以参考。主要看的还是 Binder 和 Checker</p>
<h4 id="-ts-">了解 TS 编译流程的意义</h4>
<p>了解一些 TS 的编译流程，可以借助工具对 TS 代码进行处理。比如对代码进行转换或者自动添加类型定义等等。</p>
<ul>
<li><a href="https://github.com/dsherret/ts-morph">ts-morph</a> 包装了 TS 编译器的 API，可以方便的对 TS 编译中间的内部结构进行操作。</li>
<li><a href="https://medium.com/@urish/diving-into-the-internals-of-typescript-how-i-built-typewiz-d273bbef3565">Diving into the Internals of TypeScript: How I Built TypeWiz</a> 自动根据运行时代码给 TS 代码添加类型的工具。</li>
<li><a href="https://levelup.gitconnected.com/writing-a-custom-typescript-ast-transformer-731e2b0b66e6">Writing a Custom TypeScript AST Transformer</a></li>
<li><a href="https://convincedcoder.com/2019/01/19/Processing-TypeScript-using-TypeScript/">Processing TypeScript using TypeScript</a></li>
</ul>
</div></div><footer class="footer"><address class="author">Copyright &copy;<a rel="author" href="https://github.com/zxc0328" class="author-name">ccnuzindex</a>-<a href="https://github.com/zxc0328/diary-content.git" class="source-repo">Source</a></address><p>Generated by<a href="https://github.com/joyeecheung/diary" class="site-repo">Joyee Cheung&#39;s diary generator</a></p></footer></body></html>